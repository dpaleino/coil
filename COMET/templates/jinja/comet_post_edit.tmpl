{% extends 'base.tmpl' %}
{% block extra_head %}
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

<style>
#toolbar, #post-meta-panel, #content-area {
    margin-top: 10px;
}
#save-btn, #save-icon {
    transition: all 0.5s ease;
}

@-webkit-keyframes fa-unspin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(-359deg);
    transform: rotate(-359deg);
  }
}

@keyframes fa-unspin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(-359deg);
    transform: rotate(-359deg);
  }
}

.comet-fa-spin {
    -webkit-animation: fa-spin 0.7s infinite linear;
    animation: fa-spin 0.7s infinite linear;
}

.comet-fa-unspin {
    -webkit-animation: fa-unspin 0.7s infinite linear;
    animation: fa-unspin 0.7s infinite linear;
}
</style>
{% endblock %}
{% block extra_js %}
{% if action == 'save' %}
<script>
$(document).ready(function() {
    $("#save-btn").removeClass("btn-primary").addClass("btn-success");
    $("#save-icon").removeClass("fa-save").addClass("fa-check");
    setTimeout(function() {
        $("#save-btn").removeClass("btn-success").addClass("btn-primary");
        $("#save-icon").removeClass("fa-check").addClass("fa-save");
    }, 2000);
});

$('#post-meta').on('show.bs.collapse', function () {
    $("#meta-icon").addClass("comet-fa-spin");
})

$('#post-meta').on('hide.bs.collapse', function () {
    $("#meta-icon").addClass("comet-fa-unspin");
})

$('#post-meta').on('shown.bs.collapse', function () {
    $("#meta-icon").removeClass("comet-fa-spin");
})

$('#post-meta').on('hidden.bs.collapse', function () {
    $("#meta-icon").removeClass("comet-fa-unspin");
})
</script>
{% endif %}
{% endblock %}
{% block content %}
<form method="POST" class="form-horizontal" role="form" id="form" action="/edit/{{ post.source_path }}">
<input name="title" value="{{ post.title() }}" class="form-control title input-lg" placeholder="Title">
        <div id="toolbar" class="btn-toolbar">
        <div class="btn-group">
        <button type="submit" class="btn btn-sm btn-primary" id="save-btn"><i id="save-icon" class="fa fa-save fa-fw"></i> Save</button>
        <button class="btn btn-sm btn-info" type="button" data-toggle="collapse"
        data-target="#post-meta" aria-expanded="false"
        aria-controls="post-meta" id="meta-btn"><i id="meta-icon" class="fa fa-cog fa-fw"></i> Edit metadata</button>
        </div>

        <div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="bold" title="CTRL+B"><i class="fa fa-bold"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="italic" title="CTRL+I"><i class="fa fa-italic"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="underline" title="CTRL+U"><i class="fa fa-underline"></i></a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="createLink"><i class="fa fa-link"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="removeLink"><i class="fa fa-unlink"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="insertImage"><i class="fa fa-image"></i></a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1">H1</a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2">H2</a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p">P</a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="justifyLeft"><i class="fa fa-align-left"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="justifyCenter"><i class="fa fa-align-center"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="justifyRight"><i class="fa fa-align-right"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="justifyFull"><i class="fa fa-align-justify"></i></a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="insertUnorderedList"><i class="fa fa-list-ul"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="insertOrderedList"><i class="fa fa-list-ol"></i></a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red"><i class="fa fa-circle" style="color: red;"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green"><i class="fa fa-circle" style="color: green;"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue"><i class="fa fa-circle" style="color: blue;"></i></a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-command="undo"><i class="fa fa-undo"></i></a>
          <a class="btn btn-default btn-sm" data-wysihtml5-command="redo"><i class="fa fa-repeat"></i></a>
        </div><div class="btn-group">
          <a class="btn btn-default btn-sm" data-wysihtml5-action="change_view"><i class="fa fa-code"></i></a>
        </div>
          <div data-wysihtml5-dialog="createLink" style="display: none;">
            <label>
              Link:
              <input data-wysihtml5-dialog-field="href" value="http://">
            </label>
            <a data-wysihtml5-dialog-action="save">OK</a>&nbsp;<a data-wysihtml5-dialog-action="cancel">Cancel</a>
          </div>
          <div data-wysihtml5-dialog="insertImage" style="display: none;">
            <label>
              Image:
              <input data-wysihtml5-dialog-field="src" value="http://">
            </label>
            <label>
              Align:
              <select data-wysihtml5-dialog-field="className">
                <option value="">default</option>
                <option value="wysiwyg-float-left">left</option>
                <option value="wysiwyg-float-right">right</option>
              </select>
            </label>
          </div>
        </div>
        <div class="collapse" id="post-meta">
        <div class="panel panel-info" id="post-meta-panel">
          <div class="panel-heading">
            <h3 class="panel-title">Metadata</h3>
          </div>
          <div class="panel-body">
            <input name="author.uid" value="{{ _author_uid_get(post) }}" type="hidden">
            <div class="form-group">
                <label for="author" class="col-sm-2 control-label">Author</label>
                <div class="col-sm-10">
                    <input name="author" value="{{ _author_get(post) }}" class="form-control">
                </div>
            </div>
            {% for k,v in post.meta['en'].items() %}
                {% if k not in ['title', 'author', 'author.uid'] %}
                    <div class="form-group">
                        <label for="{{ k }}" class="col-sm-2 control-label">{{ k }}</label>
                        <div class="col-sm-10">
                            <input name="{{ k }}" value="{{ v }}" class="form-control">
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            </div>
          </div>
        </div>

<textarea name="content" id="content-area" class="form-control" rows="24">{{ post_content }}</textarea>
</form>
<script src="/wysihtml/dist/wysihtml5x-toolbar.min.js"></script>
<script src="/wysihtml/parser_rules/advanced_and_extended.js"></script>
<script type="text/javascript">
    var editor = new wysihtml5.Editor('content-area', {
    toolbar: 'toolbar',
    parserRules:  wysihtml5ParserRules,
    stylesheets: ['/comet_assets/css/wysihtml5x.css']
  });
</script>
{% endblock %}
